library(shiny)
library(ggplot2)
animationOptions(interval = 100000)

shinyServer(function(input, output) {
  
  getDat <- reactive(function() {
    if (input$data == "Summer 2014 Midterm") {
      dat <- c(56.5, 53.7, 0, 80.7, 71, 56, 79.3, 0, 45.2, 0, 54, 50.3, 40.7, 104, 77, 76.2, 
               58.8, 80.7, 35.5, 90, 89.5, 78.5, 0, 0, 0, 85.5, 74, 26.5, 79.7, 48.5, 47.5, 
               60.3, 75.7, 90.7, 52.8, 92, 74.5, 57.3, 50.8, 50.7, 80.2, 50.2, 68.3, 76, 
               80.8, 80.8, 0, 73.2, 36.3, 60.7, 58.2, 19.5, 56.5, 39, 48.3, 45.5, 10)
    }
    if (input$data == "Spring 2014 Final") {
      dat <- c(74, 77, 47, 49.5, 88.5, 66, 80, 71.5, 58.5, 59, 87.5, 11, 33, 45.5, 63.5, 
               63, 48.5, 89, 83, 52.5, 79, 56, 66, 26, 55, 81.5, 66.5, 70, 95, 85, 72.5, 
               70.5, 62, 65, 23, 81.5, 53.5, 67, 86.5, 78, 49, 77.5, 81, 82, 70, 60, 87, 
               54.5, 78, 48, 35, 67.5, 62.5, 88, 84, 72.5, 33.5, 55, 47.5, 94, 71, 51.5, 
               54, 81.5, 58.5, 89, 55, 41, 92, 71.5, 70.5, 72, 57, 94, 79, 80)
    }
    if (input$data == "Spring 2014 Exam 2E") {
      dat <- c(53, 97, 69, 57, 93, 82, 89, 75, 65, 66, 91, 30, 44, 71, 71, 65, 53, 97, 
               83, 85, 88, 63, 46, 30, 66, 97, 73, 77, 96, 90, 57, 88, 56, 73, 44, 90, 
               64, 69, 92, 87, 62, 86, 83, 91, 87, 58, 83, 72, 79, 57, 50, 68, 87, 63, 
               97, 97, 83, 76, 58, 49, 96, 87, 70, 46, 75, 58, 85, 80, 41, 95, 72, 70, 
               75, 61, 73, 79, 90)
    }
    if (input$data == "Spring 2014 Exam 1E") {
      dat <- c(76, 95, 44, 68, 81, 94, 85, 85, 85, 79, 71, 94, 18, 59, 72, 89, 71, 80, 
               88, 88, 75, 92, 69, 83, 42, 72, 82, 84, 74, 97, 94, 82, 34, 91, 83, 61, 
               70, 95, 81, 87, 94, 87, 79, 83, 85, 94, 89, 88, 92, 91, 97, 86, 62, 74, 
               83, 70, 92, 92, 91, 67, 81, 57, 92, 83, 85, 66, 91, 95, 89, 79, 65, 92, 
               76, 86, 90, 40, 89, 84, 82)
    }
    if (input$data == "Fall 2013 Exam 2D") {
      dat <- c(80, 95, 74, 72, 63, 62, 86, 70, 76, 60, 73, 93, 40, 82, 96, 80, 70, 80, 84,
               77, 65, 63, 65, 96, 88, 89, 78, 78, 94, 67, 70, 79, 70, 58, 78, 80, 76, 73, 
               64, 87, 94, 78, 51, 88, 84, 66, 96, 84, 80, 84, 55, 73, 88, 65, 79, 78, 81, 
               91, 83, 88, 85, 98, 76, 92, 54, 70, 86, 91, 71, 71, 84, 84, 63, 89, 38, 83, 
               68, 72, 90, 65, 70, 78, 81, 86, 63, 71)
    }
    if (input$data == "Fall 2013 Exam 1D") {
      dat <- c(31, 87, 97, 67, 86, 73, 84, 82, 38, 77, 66, 93, 58, 71, 79, 75, 88, 86, 
               89, 79, 79, 62, 68, 88, 87, 85, 75, 93, 98, 73, 70, 78, 87, 54, 73, 88, 
               84, 83, 83, 92, 83, 70, 49, 76, 79, 88, 96, 89, 88, 89, 74, 81, 85, 78, 
               66, 72, 61, 87, 77, 83, 88, 94, 90, 96, 82, 68, 90, 90, 79, 77, 91, 93, 
               76, 89, 38, 93, 74, 65, 92, 77, 46, 88, 78, 71, 90, 63, 62, 86)
    }
    if (input$data == "2013 Exam 1C") {
      dat <- c(65, 74, 74, 67, 66, 73, 65, 63, 81, 66, 48, 52, 69, 47, 78, 75, 55, 
               67, 62, 60, 70, 66, 42, 66, 50, 55, 52, 66, 72, 77, 73, 72, 80, 73, 
               64, 66, 60, 44, 64, 52, 75, 57, 47, 59, 72, 66, 67, 82, 68, 73, 59, 
               57, 53, 75, 66, 81, 59, 52, 76, 68, 72, 53, 65, 63, 37, 23, 70, 70, 
               65, 66, 60, 58, 67, 61, 57, 73)
    } else if (input$data == "individual birthdays") {  
      dat <- c(13, 27, 19, 28, 3, 11, 12, 31, 3, 27, 2, 2, 16, 2, 24, 31, 8, 2, 
               4, 6, 13, 18, 20, 29, 10, 10, 24, 7, 2, 4, 8, 9, 16, 18, 29, 4, 21, 18, 
               26, 8, 20, 18, 6, 8, 31, 15, 23, 5, 10, 9, 17, 31, 1, 5, 18, 26, 18, 18, 
               27, 13, 26, 13, 2, 28, 12, 9, 2, 16, 18, 22, 5, 18, 11, 11, 14, 6, 23,
               6, 1, 7, 1, 11, 4, 11, 12, 14, 5, 1, 4, 29, 7, 19, 16, 28, 22, 5, 25, 
               10, 17, 22, 19, 9, 10, 15, 2, 30, 27, 4, 7, 11, 11, 23, 23, 6, 26, 21, 
               3, 17, 15, 8, 24, 31, 23, 8, 20, 1, 4, 9, 18, 19, 23, 24, 25, 30, 26, 
               21, 29, 30, 10, 8)
    } else if (input$data == "average birthdays") {  
      dat <- c(14.3, 13.8, 10.5, 13.67, 14, 16.17, 16.83, 12.167, 18.7, 13.4, 14.17, 
               8.11, 7.83, 20.17, 16.33, 15.5, 13.17, 14.67, 19, 17, 20.67)
    } else if (input$data == "2013 Exam 1D") {
      dat <- c(76, 82, 90, 56, 87, 86, 85, 81, 62, 71, 75, 97, 77, 92, 77, 95, 
               64, 62, 66, 79, 0, 87, 92, 75, 80, 87, 71, 85, 78, 84, 65, 58, 
               91, 88, 79, 60, 87, 79, 81, 86, 75, 92, 87, 89, 77, 53, 62, 61, 
               89, 63, 91, 63, 87, 69, 65, 87, 88, 81, 52, 86, 94, 59, 36, 62, 70, 
               78, 84, 91, 64, 89, 78, 92, 85, 87, 81, 95, 85, 87)
    } else if (input$data == "2013 Exam 2D") {
      dat <- c(84, 81, 81, 85, 90, 87, 80, 71, 76, 56, 78, 94, 87, 67, 52, 88, 69, 91, 73, 
               84, 77, 94, 72, 80, 90, 78, 71, 78, 65, 48, 95, 72, 90, 60, 90, 85, 83, 69, 
               80, 75, 77, 98, 69, 66, 71, 60, 80, 65, 93, 65, 79, 72, 29, 91, 92, 90, 65, 
               79, 88, 58, 74, 74, 83, 76, 95, 56, 90, 56, 98, 83, 93, 77, 93, 85, 84)
    } else if (input$data == "2012 Exam 1") {
      dat <- c(98, 80, 89, 97, 82, 71, 85, 82, 68, 66, 75, 73, 92, 100, 96, 
               91, 86, 89, 79, 68, 64, 75, 92, 97, 87, 97, 82, 71, 88, 53, 72, 
               93, 87, 88, 80, 66, 95, 92, 46, 80, 86, 0, 88, 75, 98, 32, 87, 0, 
               87, 80, 99, 87, 67, 82, 98, 96, 75, 82, 82, 87, 94, 89, 61, 92, 88, 
               95, 98, 91, 96, 91, 82, 82, 69, 90, 48, 85, 75)
    } else if (input$data == "2012 Exam 2") {
      dat <- c(89, 77, 78, 96, 72, 49, 60, 66, 41, 33, 61, 33, 83, 78, 82, 68, 88, 
               64, 75, 32, 69, 55, 88, 87, 70, 81, 62, 0, 67, 62, 72, 92, 63, 59, 70, 
               77, 91, 89, 0, 45, 90, 0, 75, 47, 87, 0, 78, 0, 75, 78, 88, 59, 64, 67,
               90, 90, 52, 70, 73, 43, 72, 88, 70, 84, 82, 81, 91, 70, 84, 83, 76, 59, 
               63, 84, 0, 0, 56)
    } else if (input$data == "rivers") {
      library(datasets)
      data(rivers)
      dat <- get("rivers")
    }
    return(dat)
  })
  
  samples <- reactive(function() {
    dat <- getDat()
    if (input$sample) {
      means <- NULL
      ctr <- 0
      while (ctr < 10000) {
        y <- sample(x=dat, size=input$n, replace=TRUE)
        means <- c(means, mean(y))
        ctr <- ctr + 1
      }
      return(means)
    } else {
      return(dat)
    }
  })
  
  output$xmin <- reactiveUI(function() {
    numericInput("xmin", "", min(getDat()))
  })
  
  output$xmax <- reactiveUI(function() {
    numericInput("xmax", "", max(getDat()))
  })
  
  output$sampDist <- renderPlot(function() {
    dat <- getDat()
    samps <- samples()
    pop.mean <- mean(dat)
    samp.mean <- mean(samps)
    v <- geom_vline(xintercept = pop.mean, color = "red") #population mean
    themes <- theme(axis.text.x=element_text(size=30),  #make stuff bigger
                    axis.text.y=element_blank(), #don't want them focusing on 'irrelevant counts'
                    plot.title=element_text(size=30, face="bold")) 
    if (input$sample) {
      title <- labs(title = paste("Sampling Distribution of the Sample Mean when n = ", input$n, sep=""))
      #v2 <- geom_vline(xintercept = samp.mean, color = "green") #sampling dist mean
      xmin <- input$xmin
      xmax <- input$xmax
    } else {
      title <- labs(title = paste("Histogram of ", input$data, sep=""))
      #v2 <- NULL
      xmin <- min(dat)
      xmax <- max(dat)
    }
    p <- qplot(samps, geom = "histogram", binwidth = input$binwidth, xlim=c(xmin, xmax), fill=I('steelblue'), col=I('black'))+
      v+title+themes+xlab("")+ylab("")
    print(p)
  })
  
  output$summary <- renderPrint({
    summary(samples())
  })
  
})